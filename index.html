<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trivial Grid</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #1e293b;
    }

    .container { max-width: 600px; width: 100%; }

    header { text-align: center; margin-bottom: 32px; }
    h1 { 
      font-size: 2rem; 
      font-weight: 700; 
      color: white; 
      text-shadow: 0 4px 12px rgba(0,0,0,0.3); 
      margin-bottom: 4px; 
    }
    .subtitle { 
      color: rgba(255,255,255,0.9); 
      font-size: 0.95rem; 
      font-weight: 500; 
    }

    .game-card {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 32px 34px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .stat { text-align: center; }
    .stat-label {
      font-size: 0.7rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .stat-value { 
      font-size: 1.3rem; 
      font-weight: 700; 
      color: #1e293b; 
    }

    .grid {
      display: grid;
      grid-template-columns: 180px 90px 90px 90px;
      grid-auto-rows: 90px;
      gap: 12px;
      margin-bottom: 28px;
      grid-template-areas:
        "q0 o0-0 o0-1 o0-2"
        "q1 o1-0 o1-1 o1-2"
        "q2 o2-0 o2-1 o2-2"
        "q3 o3-0 o3-1 o3-2"
        "q4 o4-0 o4-1 o4-2"
        "q5 o5-0 o5-1 o5-2";
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        grid-template-areas:
          "q0"
          "o0-0"
          "o0-1"
          "o0-2"
          "q1"
          "o1-0"
          "o1-1"
          "o1-2"
          "q2"
          "o2-0"
          "o2-1"
          "o2-2"
          "q3"
          "o3-0"
          "o3-1"
          "o3-2"
          "q4"
          "o4-0"
          "o4-1"
          "o4-2"
          "q5"
          "o5-0"
          "o5-1"
          "o5-2";
        grid-auto-rows: auto;
      }
    }

    .category-question {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 8px;
    }

    .category-label {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      text-align: left;
    }

    .question-text {
      font-size: 0.8rem;
      font-weight: 500;
      text-align: left;
      line-height: 1.3;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      flex: 1;
    }

    .question-text.active {
      opacity: 1;
      visibility: visible;
    }

    .option {
      border: 2px solid #e2e8f0;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      text-align: center;
      padding: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #ffffff;
      line-height: 1.2;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }

    .option:hover:not(.correct):not(.incorrect):not(.locked) {
      border-color: #6366f1;
      background: rgba(99,102,241,0.08);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99,102,241,0.15);
    }

    .correct { 
      border-color: #10b981 !important; 
      box-shadow: 0 0 0 3px rgba(16,185,129,0.3) !important;
    }

    .incorrect { 
      border-color: #ef4444 !important; 
      box-shadow: 0 0 0 3px rgba(239,68,68,0.3) !important;
    }

    .locked { 
      cursor: default !important; 
      opacity: 0.7; 
    }

    @keyframes shake {
      0%,100%{transform:translateX(0);}25%{transform:translateX(-4px);}75%{transform:translateX(4px);}
    }
    .shake { animation: shake 0.3s ease-in-out; }

    .reset-btn {
      width: 100%; height: 48px; border: none; border-radius: 16px;
      background: linear-gradient(135deg,#6366f1,#8b5cf6); color: white;
      font-size: 0.95rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.05em; cursor: pointer; transition: all 0.2s ease;
    }
    .reset-btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 12px 30px rgba(99,102,241,0.4); 
    }

    .footer { 
      text-align: center; 
      margin-top: 24px; 
      color: rgba(255,255,255,0.9); 
      font-size: 0.8rem; 
    }

    @media (max-width: 480px) {
      .grid { gap: 10px; }
      .option { font-size: 0.8rem; padding: 6px; }
      .question-text { font-size: 0.78rem; padding: 6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Trivial Grid</h1>
    </header>

    <div class="game-card">
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Intentos</div>
          <div class="stat-value" id="attempts">1</div>
        </div>
        <div class="stat">
          <div class="stat-label">Progreso</div>
          <div class="stat-value" id="progress">0/6</div>
        </div>
      </div>

      <div class="grid" id="grid"></div>
      <button class="reset-btn" onclick="resetGame(event)">Nueva Partida</button>
    </div>

    <div class="footer">VersiÃ³n Beta Â· Â© 2025 Trivial Grid</div>
  </div>

  <script src="questions.js"></script>
  <script>
    const categories = ['GEOGRAFÃA', 'ENTRETENIMIENTO', 'HISTORIA', 'ARTE Y LITERATURA', 'CIENCIAS Y NATURALEZA', 'DEPORTE Y PASATIEMPOS'];
    let gameState = { attempts: 1, correctAnswers: new Set(), currentRound: {}, suspendCounting: false };
    let currentActiveCategory = 0;
    let normalizedQuestions = {};
    let appInitialized = false;

    function normalizeKey(name) {
      return name
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/\s+/g, '')
        .replace(/y/g, '')
        .replace(/[^a-z0-9]/g, '');
    }

    function buildQuestionIndex() {
      if (typeof trivialQuestions === 'undefined') return;
      normalizedQuestions = {};
      Object.keys(trivialQuestions).forEach(k => {
        try {
          const val = trivialQuestions[k];
          const norm = normalizeKey(k);
          normalizedQuestions[k] = val;
          normalizedQuestions[k.toLowerCase()] = val;
          normalizedQuestions[norm] = val;
        } catch (e) {
          console.error('Error indexing questions key', k, e);
        }
      });
    }

    function initGrid() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      categories.forEach((cat, catIndex) => {
        // Columna 1: CategorÃ­a + Pregunta
        const catQuestion = document.createElement('div');
        catQuestion.className = 'category-question';
        catQuestion.dataset.category = catIndex;
        catQuestion.id = `cat-${catIndex}`;

        const label = document.createElement('div');
        label.className = 'category-label';
        label.textContent = cat;
        catQuestion.appendChild(label);

        const question = document.createElement('div');
        question.className = 'question-text';
        question.id = `question-${catIndex}`;
        catQuestion.appendChild(question);

        grid.appendChild(catQuestion);

        // Columnas 2,3,4: Opciones
        for(let i = 0; i < 3; i++) {
          const option = document.createElement('div');
          option.className = 'option';
          option.dataset.category = catIndex;
          option.dataset.option = i;
          grid.appendChild(option);
        }
      });

      startNewRound();
      activateCategory(0); // GeografÃ­a primero
      attachListeners();
      updateStats();
    }

      function startNewRound() {
        gameState.currentRound = {};
        categories.forEach((catName, catIndex) => {
          if (!gameState.correctAnswers.has(catIndex)) {
            const norm = normalizeKey(catName);
            const questions = normalizedQuestions[catName] || normalizedQuestions[catName.toLowerCase()] || normalizedQuestions[norm] || trivialQuestions[catName];
            if (questions) {
              gameState.currentRound[catIndex] = questions[Math.floor(Math.random() * questions.length)];
            }
          }
        });
      }

    function activateCategory(catIndex) {
      if (gameState.correctAnswers.has(catIndex)) return;

      const questionCell = document.getElementById(`question-${catIndex}`);
      const options = document.querySelectorAll(`.option[data-category="${catIndex}"]`);
      const questionData = gameState.currentRound[catIndex];

      if (questionData) {
        questionCell.textContent = questionData.q;
        questionCell.classList.add('active');
        
        options.forEach((opt, i) => {
          opt.textContent = questionData.options[i];
          opt.classList.remove('correct', 'incorrect', 'locked');
        });
        
        currentActiveCategory = catIndex;
      }
    }

    function activateNextCategory() {
      for(let i = currentActiveCategory + 1; i < categories.length; i++) {
        if (!gameState.correctAnswers.has(i)) {
          activateCategory(i);
          return;
        }
      }
    }

    function attachListeners() {
      document.querySelectorAll('.option').forEach(option => {
        option.onclick = function(e) {
          const catIndex = parseInt(this.dataset.category);
          const optIndex = parseInt(this.dataset.option);
          handleAnswer(catIndex, optIndex, this, e);
        };
      });
    }

    function handleAnswer(catIndex, optIndex, clickedOption, event) {
      if (gameState.correctAnswers.has(catIndex)) return;

      const questionData = gameState.currentRound[catIndex];
      if (!questionData) return;

      const correctIndex = questionData.correct;
      // `attempts` counts game starts only â€” do not change here when answering.

      const questionCell = document.getElementById(`question-${catIndex}`);
      const options = document.querySelectorAll(`.option[data-category="${catIndex}"]`);

      if (optIndex === correctIndex) {
        // Correcta
        options[correctIndex].classList.add('correct');
        gameState.correctAnswers.add(catIndex);
        updateStats();

        setTimeout(() => {
          if (gameState.correctAnswers.size === categories.length) {
            setTimeout(() => alert(`ðŸŽ‰ Â¡TRIVIAL COMPLETADO!\n${gameState.attempts} intentos`), 400);
          } else {
            activateNextCategory();
          }
        }, 600);
      } else {
        // ErrÃ³nea
        updateStats();
        clickedOption.classList.add('incorrect', 'shake');
        options[correctIndex].classList.add('correct');
        setTimeout(() => clickedOption.classList.remove('shake'), 300);
        // Lock all options on wrong answer
        document.querySelectorAll('.option').forEach(opt => opt.classList.add('locked'));
        // Show next question but don't allow answering
        setTimeout(() => activateNextCategory(), 600);
      }
    }

    function updateStats() {
      document.getElementById('attempts').textContent = gameState.attempts;
      document.getElementById('progress').textContent = `${gameState.correctAnswers.size}/6`;
    }

    function resetGame(event) {
      // `attempts` counts how many games were started.
      // If this reset was triggered by a real user click, increment attempts;
      // if it's an automatic initialization (no event) reset to 1.
      const newAttempts = (event && event.isTrusted) ? (gameState.attempts + 1) : 1;
      gameState = { attempts: newAttempts, correctAnswers: new Set(), currentRound: {}, suspendCounting: false };
      currentActiveCategory = 0;
      initGrid();
      updateStats();
    }

    function initWhenReady() {
      if (appInitialized) return;
      if (typeof trivialQuestions !== 'undefined') {
        buildQuestionIndex();
        initGrid();
        appInitialized = true;
      } else {
        setTimeout(initWhenReady, 50);
      }
    }
    initWhenReady();
  </script>
</body>
</html>
